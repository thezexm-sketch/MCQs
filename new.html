<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med Questions - Pro Version</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #f5f7fa;
            --card: #ffffff;
            --text: #2d3436;
            --primary: #0984e3;
            --correct: #27ae60;
            --wrong: #d63031;
            --border: #dfe6e9;
            --unsolved: #b2bec3;
        }

        body[data-theme='dark'] {
            --bg: #121212;
            --card: #1e1e1e;
            --text: #f5f6fa;
            --primary: #3498db;
            --border: #333333;
            --unsolved: #636e72;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÅŸÑÿßÿ™ÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© ÿ¨ŸÜÿ® ÿ®ÿπÿ∂ --- */
        .mode-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            width: 95%;
            max-width: 500px;
            justify-content: center;
        }

        .mode-option {
            background: var(--card);
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: 0.2s;
            flex: 1;
            justify-content: center;
        }

        .radio-circle {
            width: 18px;
            height: 18px;
            border: 2px solid var(--unsolved);
            border-radius: 50%;
            transition: 0.3s;
        }

        /* ÿ≠ÿßŸÑÿ© All */
        .mode-option.active[data-mode="all"] {
            border-color: var(--primary);
        }

        .mode-option.active[data-mode="all"] .radio-circle {
            border-color: var(--primary);
            background: var(--primary);
            box-shadow: inset 0 0 0 3px var(--card);
        }

        /* ÿ≠ÿßŸÑÿ© Incorrect */
        .mode-option.active[data-mode="incorrect"] {
            border-color: var(--wrong);
        }

        .mode-option.active[data-mode="incorrect"] .radio-circle {
            border-color: var(--wrong);
            background: var(--wrong);
            box-shadow: inset 0 0 0 3px var(--card);
        }

        .mode-label {
            font-weight: bold;
            font-size: 0.95rem;
        }

        /* --- ÿ®ÿßŸÇŸä ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇÿßÿ™ ŸÖŸÜ ŸÉŸàÿØŸÉ ÿßŸÑÿ£ÿµŸÑŸä --- */
        .opt {
            display: block;
            width: 100%;
            padding: 16px 20px;
            margin-bottom: 12px;
            background-color: transparent;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text);
            text-align: left;
            box-sizing: border-box;
        }

        .opt:hover:not(:disabled) {
            border-color: var(--primary);
            background-color: rgba(9, 132, 227, 0.05);
        }

        .correct-opt {
            background: var(--correct) !important;
            color: white !important;
            border-color: var(--correct) !important;
        }

        .wrong-opt {
            background: var(--wrong) !important;
            color: white !important;
            border-color: var(--wrong) !important;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
        }

        .q-count-input {
            width: 70px;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: var(--bg);
            color: var(--text);
            text-align: center;
            font-weight: bold;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .shake {
            animation: shake 0.4s cubic-bezier(.36, .07, .19, .97) both;
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }

            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0);
            }

            40%,
            60% {
                transform: translate3d(4px, 0, 0);
            }
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -285px;
            width: 260px;
            height: 100%;
            background: var(--card);
            z-index: 4000;
            transition: 0.4s;
            padding: 20px;
            overflow-y: auto;
            display: none;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
        }

        .sidebar.open {
            left: 0 !important;
        }

        #menu-trigger {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 5000;
            cursor: pointer;
            background: var(--primary);
            padding: 12px;
            border-radius: 12px;
            display: none;
            flex-direction: column;
            gap: 4px;
        }

        #menu-trigger span {
            width: 20px;
            height: 3px;
            background: white;
        }

        .dot {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            background: var(--unsolved);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            border: 2px solid transparent;
        }

        .dot.active {
            border: 3px solid #0000FF !important;
            box-shadow: 0 0 15px var(--primary);
        }

        .dot.correct {
            background: var(--correct);
        }

        .dot.wrong {
            background: var(--wrong);
        }

        #home-page {
            margin-top: 50px;
            width: 95%;
            max-width: 1100px;
            text-align: center;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(290px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .card {
            background: var(--card);
            border-radius: 24px;
            padding: 20px;
            border: 2px solid var(--border);
            cursor: pointer;
            position: relative;
            transition: 0.3s;
            overflow: hidden;
            text-align: left;
        }

        .card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
        }

        .card-banner {
            width: calc(100% + 40px);
            margin: -20px -20px 15px -20px;
            height: 160px;
            object-fit: cover;
        }

        /* Badge Styles */
        .badge {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--unsolved);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
            transition: 0.3s;
        }

        .badge.wrong-mode {
            background: var(--wrong);
        }

        .dots-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 24px;
            color: white;
            background: rgba(0, 0, 0, 0.3);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .card-menu {
            position: absolute;
            top: 52px;
            right: 12px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: none;
            z-index: 100;
        }

        .card-menu div {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            color: var(--text);
            border-bottom: 1px solid var(--border);
        }

        #quiz-area {
            display: none;
            width: 90%;
            max-width: 800px;
            margin-top: 80px;
        }

        .quiz-card {
            background: var(--card);
            padding: 35px;
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            width: 100%;
            box-sizing: border-box;
        }

        #success-screen {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .action-btn {
            padding: 14px 25px;
            border: none;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .footer {
            margin-top: 60px;
            padding: 25px;
            font-weight: bold;
            border-top: 1px solid var(--border);
            width: 100%;
            text-align: center;
            opacity: 0.8;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body data-theme="light" onclick="closeAllMenus()">

    <div id="menu-trigger" onclick="event.stopPropagation(); toggleSidebar()">
        <span></span><span></span><span></span>
    </div>

    <div id="sidebar" class="sidebar"></div>

    <div style="position: fixed; top: 15px; right: 15px; display: flex; gap: 10px; z-index: 3000;">
        <button id="home-btn" class="hidden action-btn" onclick="location.reload()"
            style="padding: 10px 15px;">üè†</button>
        <button onclick="toggleTheme()" class="action-btn"
            style="padding: 10px 15px; background: var(--card); color: var(--text); border: 1px solid var(--border);">üåì</button>
    </div>

    <div id="home-page" class="fade-in">
        <h1>1st year Questions</h1>

        <div class="mode-selector">
            <div class="mode-option active" data-mode="all" onclick="setFilter('all')">
                <div class="radio-circle"></div>
                <span class="mode-label">All Questions</span>
            </div>
            <div class="mode-option" data-mode="incorrect" onclick="setFilter('incorrect')">
                <div class="radio-circle"></div>
                <span class="mode-label">Incorrect Only</span>
            </div>
        </div>

        <div class="module-grid">
            <div class="card" onclick="startSession('blood')">
                <div class="dots-btn" onclick="toggleCardMenu(event, 'menu-blood')">‚ãÆ</div>
                <div id="menu-blood" class="card-menu">
                    <div onclick="resetProgress(event, 'blood')">üîÑ Reset Progress</div>
                </div>
                <img src="blood.png" class="card-banner">
                <div class="badge" id="count-blood">0</div>
                <h3>Blood Module</h3>
                <div class="input-group" onclick="event.stopPropagation()">
                    <input type="number" id="input-blood" class="q-count-input" value="20">
                    <button class="action-btn" style="flex:1;" onclick="startSession('blood')">Start Quiz</button>
                </div>
            </div>

            <div class="card" onclick="startSession('foundation')">
                <div class="dots-btn" onclick="toggleCardMenu(event, 'menu-found')">‚ãÆ</div>
                <div id="menu-found" class="card-menu">
                    <div onclick="resetProgress(event, 'foundation')">üîÑ Reset Progress</div>
                </div>
                <img src="found.png" class="card-banner">
                <div class="badge" id="count-foundation">0</div>
                <h3>Foundation</h3>
                <div class="input-group" onclick="event.stopPropagation()">
                    <input type="number" id="input-foundation" class="q-count-input" value="20">
                    <button class="action-btn" style="flex:1;" onclick="startSession('foundation')">Start Quiz</button>
                </div>
            </div>
        </div>
        <div class="footer">Directed by Dr/Mahmoud & Abdallah</div>
    </div>

    <div id="quiz-area">
        <div class="quiz-card fade-in" id="q-container">
            <div id="q-text" style="font-weight: bold; font-size: 1.2rem; margin-bottom: 25px;"></div>
            <div id="options-box"></div>
            <div style="display:flex; gap:12px; margin-top:25px;">
                <button class="action-btn" style="background:#636e72; flex:1;" onclick="prev()">‚Üê Previous</button>
                <button class="action-btn" style="flex:1;" onclick="next()">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <div id="success-screen">
        <h1 style="font-size: 4rem; margin: 0;">üéâ</h1>
        <h2>Well Done!</h2>
        <div style="display: flex; gap: 15px; margin-top: 20px;">
            <button class="action-btn" style="background: var(--correct);" onclick="reviewMode()">üîç Review
                Answers</button>
            <button class="action-btn" onclick="location.reload()">üè† Home</button>
        </div>
    </div>
    <script src="blood.js"></script>
    <script>

        BLOOD_QUESTIONS.forEach(q => q.mod = 'blood');
        FOUNDATION_QUESTIONS.forEach(q => q.mod = 'foundation');
        const ALL_DATA = [...BLOOD_QUESTIONS, ...FOUNDATION_QUESTIONS];

        let sessionQs = [];
        let currentIdx = 0;
        let progress = JSON.parse(localStorage.getItem('medV12')) || {};
        let isReview = false;
        let currentFilter = 'all';

        (function init() {
            const savedTheme = localStorage.getItem('medTheme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            updateDashboard();
        })();

        function setFilter(f) {
            currentFilter = f;
            document.querySelectorAll('.mode-option').forEach(opt => {
                opt.classList.toggle('active', opt.getAttribute('data-mode') === f);
            });
            updateDashboard();
        }

        function toggleTheme() {
            const current = document.body.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('medTheme', newTheme);
        }

        function updateDashboard() {
            ['blood', 'foundation'].forEach(m => {
                const badge = document.getElementById(`count-${m}`);
                const qs = ALL_DATA.filter(q => q.mod === m);

                if (currentFilter === 'all') {
                    // ÿπÿØÿØ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÑŸä ŸÑÿ≥Ÿá ŸÖÿßÿ™ÿ≠ŸÑÿ™ÿ¥ ÿµÿ≠ (All)
                    badge.innerText = qs.filter(q => progress[q.q] !== 'correct').length;
                    badge.classList.remove('wrong-mode');
                    badge.style.background = 'var(--unsolved)';
                } else {
                    // ÿπÿØÿØ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ∫ŸÑÿ∑ (Incorrect)
                    badge.innerText = qs.filter(q => progress[q.q] === 'wrong').length;
                    badge.classList.add('wrong-mode');
                    badge.style.background = 'var(--wrong)';
                }
            });
        }

        function toggleCardMenu(e, id) {
            e.stopPropagation();
            const menu = document.getElementById(id);
            const isVisible = menu.style.display === 'block';
            closeAllMenus();
            if (!isVisible) menu.style.display = 'block';
        }

        function closeAllMenus() {
            document.querySelectorAll('.card-menu').forEach(m => m.style.display = 'none');
        }

        function resetProgress(e, type) {
            e.stopPropagation();
            if (!confirm("Reset progress?")) return;
            ALL_DATA.filter(q => q.mod === type).forEach(q => delete progress[q.q]);
            localStorage.setItem('medV12', JSON.stringify(progress));
            updateDashboard();
            closeAllMenus();
        }

        function startSession(type) {
            let baseQs = [];
            if (currentFilter === 'all') {
                baseQs = ALL_DATA.filter(q => q.mod === type && progress[q.q] !== 'correct');
            } else {
                baseQs = ALL_DATA.filter(q => q.mod === type && progress[q.q] === 'wrong');
            }

            if (baseQs.length === 0) return alert("No questions found for this selection!");

            const inputId = `input-${type}`;
            let num = document.getElementById(inputId).value;

            sessionQs = baseQs.sort(() => Math.random() - 0.5).slice(0, parseInt(num) || baseQs.length);
            currentIdx = 0;
            isReview = false;

            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('quiz-area').style.display = 'block';
            document.getElementById('home-btn').classList.remove('hidden');
            document.getElementById('menu-trigger').style.display = 'flex';
            document.getElementById('sidebar').style.display = 'flex';

            renderSidebar();
            loadQ();
        }

        function loadQ() {
            const q = sessionQs[currentIdx];
            document.getElementById('q-container').classList.remove('shake');
            document.getElementById('q-text').innerText = q.q;
            const box = document.getElementById('options-box');
            box.innerHTML = '';

            q.o.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'opt'; btn.innerText = opt;

                if (q.sessionSolved || isReview) {
                    btn.disabled = true;
                    if (i === q.a) btn.classList.add('correct-opt');
                    if (q.lastAnswer === i && i !== q.a) btn.classList.add('wrong-opt');
                } else {
                    btn.onclick = () => handleAnswer(i, q, btn);
                }
                box.appendChild(btn);
            });
            updateDots();
        }

        function handleAnswer(choice, q, btn) {
            const isCorrect = choice === q.a;
            q.lastAnswer = choice;
            q.sessionSolved = true;
            document.querySelectorAll('.opt').forEach(b => b.disabled = true);

            if (isCorrect) {
                btn.classList.add('correct-opt');
                progress[q.q] = 'correct';
                confetti({ particleCount: 40, spread: 50 });
            } else {
                btn.classList.add('wrong-opt');
                document.querySelectorAll('.opt')[q.a].classList.add('correct-opt');
                document.getElementById('q-container').classList.add('shake');
                progress[q.q] = 'wrong';
            }
            localStorage.setItem('medV12', JSON.stringify(progress));
            updateDots();
            updateDashboard();

            if (currentIdx === sessionQs.length - 1) {
                setTimeout(() => {
                    document.getElementById('quiz-area').style.display = 'none';
                    document.getElementById('success-screen').style.display = 'flex';
                }, 1000);
            }
        }

        function renderSidebar() {
            const side = document.getElementById('sidebar');
            side.innerHTML = '<h3 style="width:100%; border-bottom: 2px solid var(--primary); padding-bottom:10px;">Progress</h3>';
            sessionQs.forEach((_, i) => {
                const d = document.createElement('div');
                d.className = 'dot'; d.innerText = i + 1; d.id = `dot-${i}`;
                d.onclick = () => { currentIdx = i; loadQ(); toggleSidebar(); };
                side.appendChild(d);
            });
        }

        function updateDots() {
            document.querySelectorAll('.dot').forEach((d, i) => {
                d.classList.remove('active');
                if (i === currentIdx) d.classList.add('active');
                const q = sessionQs[i];
                if (q && q.sessionSolved) {
                    d.classList.add(q.lastAnswer === q.a ? 'correct' : 'wrong');
                }
            });
        }

        function reviewMode() { isReview = true; currentIdx = 0; document.getElementById('success-screen').style.display = 'none'; document.getElementById('quiz-area').style.display = 'block'; loadQ(); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function next() { if (currentIdx < sessionQs.length - 1) { currentIdx++; loadQ(); } }
        function prev() { if (currentIdx > 0) { currentIdx--; loadQ(); } }

        updateDashboard();
    </script>
</body>

</html>
